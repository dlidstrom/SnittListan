{"version":1,"ops":[{"type":3,"author":{"id":"027a2bcb19402705046b570711cd98e591403e96"},"timestamp":1515572786,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDM1NjUzMzMxNA==","github-url":"https://github.com/dlidstrom/Snittlistan/issues/332#issuecomment-356533314"},"message":"Alla matcher ska verifieras i efterhand (efter 5 dagar). Det innebär att `MatchResult` och `MatchResult4` ska ha en flagga `IsVerified`. En gång om dagen, säg 12:00, så läser vi upp alla matcher och går igenom dom. De som inte är verifierade ska signallera ett domain event som köar upp en task som ska köras i MSMQ. Den tasken ska hämta resultatet från bits och ladda upp matchen och be matchen att verifiera sig. Om allt stämmer så signalleras att matchen är verifierad och klar (det ska gå ut ett mail). Om något ändras så ska det också signalleras och skickas mail (precis som när en match registreras automatiskt).\n\n- [x] Skapa ett schemalagt jobb som läser upp alla matcher från säsongen. Det kan man göra genom att läsa upp `Roster` för säsongen och hämta deras `MatchResultId`. Gör det bara om det finns ett `BitsMatchId`. Den ska gå igenom alla databaser genom att ha en konfiguration i app.config som räknar upp alla databaser som finns tillsammans med relevant url för det api som ska anropas.\n- [x] Be alla `MatchResult` signallera om dom ska verifieras (äldre än 5 dagar). Ett domain event är lämpligt som köar upp en task på MSMQ.\n- [x] Skapa en tjänst som hanterar MSMQ. En kö räcker. Den ska läsa bus command och köra en bus command handler.\n- [ ] Installera schemalagda jobbet genom WiX (12:00 varje dag).\n- [ ] Installera MSMQ-tjänsten genom WiX. Den ska ha ett startup beroende på MSMQ.\n- [x] Även registermatch måste gå genom kön.\n- [x] Tool ska inte ha ett beroende till Web-tjänsten.\n- [x] Ersätt konfigurationen för `Snittlistan.Tool` vid installation.\n- [ ] Lägg till körning av `registermatch` från 12:00 till 23:00, var 10:e minut. Varje dag.\n- [x] Stäng av task api utifrån:\n```\npublic class CustomActionAttribute : FilterAttribute, IActionFilter {\n    public void OnActionExecuting(ActionExecutingContext filterContext) {\n        if (filterContext.HttpContext.Request.IsLocal == false) {\n            filterContext.Result = new HttpNotFoundResult();\n        }\n    }\n}\n```\n- [x] Undvik index genom att skicka med gamla roster players när matchen uppdateras.\n- [x] Uppdatera även Roster så att den får nya players. Kan ju vara så att någon bytts ut helt (inte var reserv heller).","files":null},{"type":4,"author":{"id":"027a2bcb19402705046b570711cd98e591403e96"},"timestamp":1516574023,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MTQzNDIzNzgwNA=="},"status":2}]}